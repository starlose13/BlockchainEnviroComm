<!DOCTYPE html>
<html class="writer-html5" lang="en">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Upgradable Smart Contracts &mdash; decentralized communication v0.1 documentation</title>
      <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=80d5e7a1" />
      <link rel="stylesheet" type="text/css" href="_static/css/theme.css?v=19f00094" />
      <link rel="stylesheet" type="text/css" href="_static/custom.css?v=8e6f1441" />

  
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="_static/jquery.js?v=5d32c60e"></script>
        <script src="_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js?v=4c0d86c8"></script>
        <script src="_static/doctools.js?v=888ff710"></script>
        <script src="_static/sphinx_highlight.js?v=4825356b"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="ChainlinkAutomation Contract Documentation" href="docs_chainlink_automation_contract.html" />
    <link rel="prev" title="ConsensusMechanism Contract Documentation" href="docs_consensus_mechanism_contract.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="index.html" class="icon icon-home">
            decentralized communication
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="overview.html">Next-Generation Command and Control</a></li>
<li class="toctree-l1"><a class="reference internal" href="quickstart.html">Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="contracts_structure.html">General Structure of Solidity Smart Contracts</a></li>
<li class="toctree-l1"><a class="reference internal" href="docs_node_manager_contract.html">NodeManager Contract Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="docs_consensus_mechanism_contract.html">ConsensusMechanism Contract Documentation</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Upgradable Smart Contracts</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#introduction">Introduction</a></li>
<li class="toctree-l2"><a class="reference internal" href="#key-components">1. Key Components</a></li>
<li class="toctree-l2"><a class="reference internal" href="#contract-relationships-and-workflow">2. Contract Relationships and Workflow</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id5">}</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id10">}</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#ownership-and-role-management">3. Ownership and Role Management</a></li>
<li class="toctree-l2"><a class="reference internal" href="#summary">4. Summary</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="docs_chainlink_automation_contract.html">ChainlinkAutomation Contract Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="docs_minimal_account_abstraction.html">MinimalAccountAbstraction Contract Documentation</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">decentralized communication</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">Upgradable Smart Contracts</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/docs_upgradable_contract.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="upgradable-smart-contracts">
<h1>Upgradable Smart Contracts<a class="headerlink" href="#upgradable-smart-contracts" title="Permalink to this heading"></a></h1>
<section id="introduction">
<h2>Introduction<a class="headerlink" href="#introduction" title="Permalink to this heading"></a></h2>
<p>This document provides a comprehensive overview of the upgradable smart contracts used in the project. Leveraging OpenZeppelin and Chainlink libraries, these contracts ensure secure and efficient upgrades, address management, access control, and initialization. Key components include:</p>
<ul class="simple">
<li><p><strong>UUPSUpgradeable</strong> from OpenZeppelin</p></li>
<li><p><strong>AddressUpgradeable</strong> from Chainlink</p></li>
<li><p><strong>AccessControlUpgradeable</strong> from OpenZeppelin</p></li>
<li><p><strong>Initializable</strong> from OpenZeppelin</p></li>
</ul>
</section>
<section id="key-components">
<h2>1. Key Components<a class="headerlink" href="#key-components" title="Permalink to this heading"></a></h2>
<p><strong>UUPSUpgradeable</strong></p>
<p><em>Purpose</em>:
The <cite>UUPSUpgradeable</cite> contract from OpenZeppelin facilitates upgradability by adhering to the Universal Upgradeable Proxy Standard (UUPS). This enables updating the contract’s logic while preserving its state.</p>
<p><em>Functionality</em>:
- <strong>Upgradability</strong>: Allows contract logic updates through a delegated upgrade mechanism, ensuring that the contract’s state remains intact during upgrades.</p>
<p><em>Integration</em>:
Implemented in both the Node Manager and Consensus Mechanism contracts to manage contract upgrades effectively.</p>
<a class="reference internal image-reference" href="_images/proxy-contract.png"><img alt="Description of the image" class="align-center" src="_images/proxy-contract.png" style="width: 600px;" /></a>
<p><strong>AddressUpgradeable</strong></p>
<p><em>Purpose</em>:
The <cite>AddressUpgradeable</cite> contract from Chainlink provides utilities for managing addresses securely and efficiently.</p>
<p><em>Functionality</em>:
- <strong>Address Validation</strong>: Offers functions to ensure that address operations are secure and correct, preventing the use of invalid or malicious addresses.</p>
<p><em>Integration</em>:
Used across smart contracts to manage and validate addresses.</p>
<p><strong>AccessControlUpgradeable</strong></p>
<p><em>Purpose</em>:
The <cite>AccessControlUpgradeable</cite> contract from OpenZeppelin provides a role-based access control mechanism, ensuring secure and controlled access to contract functions.</p>
<p><em>Functionality</em>:
- <strong>Role Management</strong>: Manages roles and permissions within the contract, restricting access based on assigned roles.</p>
<p><em>Integration</em>:
Incorporated in the Node Manager and Consensus Mechanism contracts for managing access and enforcing security policies.</p>
<p><strong>Initializable</strong></p>
<p><em>Purpose</em>:
The <cite>Initializable</cite> contract from OpenZeppelin manages the initialization of upgradable contracts, ensuring initialization is performed only once.</p>
<p><em>Functionality</em>:
- <strong>Initialization Management</strong>: Prevents reinitialization by providing mechanisms for safe setup of contract state variables.</p>
<p><em>Integration</em>:
Used in both Node Manager and Consensus Mechanism contracts for proper initialization during deployment or upgrades.</p>
</section>
<section id="contract-relationships-and-workflow">
<h2>2. Contract Relationships and Workflow<a class="headerlink" href="#contract-relationships-and-workflow" title="Permalink to this heading"></a></h2>
<p><strong>Node Manager Contract</strong></p>
<p><em>Function</em>:
Manages nodes within the network, including node registration and maintenance of node-related data.</p>
<p><em>Initialization</em>:
<a href="#id1"><span class="problematic" id="id2">``</span></a><a href="#id3"><span class="problematic" id="id4">`</span></a>solidity
function initialize(</p>
<blockquote>
<div><p>address[] memory _nodeAddresses,
DataTypes.NodeRegion[] memory _currentPosition,
string[] memory nodePosition,
string[] memory latitude,
string[] memory longitude</p>
</div></blockquote>
<dl>
<dt>) public initializer {</dt><dd><dl class="simple">
<dt>if (_nodeAddresses.length != _currentPosition.length) {</dt><dd><p>revert Errors.ARRAYS_LENGTH_IS_NOT_EQUAL();</p>
</dd>
</dl>
<p>}
CONTRACT_ADMIN = msg.sender;
UPGRADER_ROLE = keccak256(“UPGRADER_ROLE”);
__Ownable_init(CONTRACT_ADMIN);
_initializeNodes(</p>
<blockquote>
<div><p>_nodeAddresses,
_currentPosition,
nodePosition,
latitude,
longitude</p>
</div></blockquote>
<p>);
__UUPSUpgradeable_init();</p>
</dd>
</dl>
<section id="id5">
<h3>}<a class="headerlink" href="#id5" title="Permalink to this heading"></a></h3>
<ul class="simple">
<li><p><strong>Details</strong>: Initializes the Node Manager with node addresses, regions, and geographical data. Sets up the contract admin, upgrades role management, and initializes nodes.</p></li>
<li><p><strong>Integration</strong>: Utilizes <cite>Initializable</cite> for setup, <cite>UUPSUpgradeable</cite> for upgradability, and <cite>Ownable</cite> for ownership management.</p></li>
</ul>
<p><strong>Consensus Mechanism Contract</strong></p>
<p><em>Function</em>:
Handles the consensus process, including managing consensus thresholds and epochs.</p>
<p><em>Initialization</em>:
<a href="#id6"><span class="problematic" id="id7">``</span></a><a href="#id8"><span class="problematic" id="id9">`</span></a>solidity
function initialize(</p>
<blockquote>
<div><p>uint8 _s_consensusThreshold,
address nodeManagerContractAddress,
address policyCustodian</p>
</div></blockquote>
<dl class="simple">
<dt>) public initializer {</dt><dd><p>__Ownable_init(policyCustodian);
__UUPSUpgradeable_init();
__AccessControl_init();
UPGRADER_ROLE = keccak256(“UPGRADER_ROLE”);
CONSENSUS_NOT_REACHED = 0;
isEpochNotStarted = true;
consensusEpochTimeDuration = 1 minutes;
POLICY_CUSTODIAN = policyCustodian;
s_lastTimeStamp = block.timestamp;
s_consensusThreshold = _s_consensusThreshold;
nodeManager = INodeManager(nodeManagerContractAddress);</p>
</dd>
</dl>
</section>
<section id="id10">
<h3>}<a class="headerlink" href="#id10" title="Permalink to this heading"></a></h3>
<ul class="simple">
<li><p><strong>Details</strong>: Sets up the Consensus Mechanism with threshold values, node manager address, and policy custodian. Configures upgrade roles, epoch settings, and consensus state management.</p></li>
<li><p><strong>Integration</strong>: Employs <cite>Initializable</cite> for initialization, <cite>UUPSUpgradeable</cite> for contract upgrades, <cite>AccessControlUpgradeable</cite> for role management, and <cite>Ownable</cite> for ownership.</p></li>
</ul>
</section>
</section>
<section id="ownership-and-role-management">
<h2>3. Ownership and Role Management<a class="headerlink" href="#ownership-and-role-management" title="Permalink to this heading"></a></h2>
<p><strong>Policy Custodian</strong></p>
<ul class="simple">
<li><p><strong>Role</strong>: The Policy Custodian address is the owner of the UUPS address. This role is crucial for managing contract upgrades and maintaining control over the upgrade process.</p></li>
</ul>
</section>
<section id="summary">
<h2>4. Summary<a class="headerlink" href="#summary" title="Permalink to this heading"></a></h2>
<p>The upgradable smart contracts in this project are structured to support ongoing enhancements while maintaining operational integrity. By incorporating <cite>UUPSUpgradeable</cite>, <cite>AddressUpgradeable</cite>, <cite>AccessControlUpgradeable</cite>, and <cite>Initializable</cite>, these contracts provide a secure and efficient framework for managing upgrades, addresses, and access controls.</p>
<p>The <strong>Policy Custodian</strong> address, as the owner of the UUPS address, ensures proper management of upgrades. The <cite>initialize</cite> functions in both the Node Manager and Consensus Mechanism contracts set up the necessary parameters and roles, ensuring that each contract is configured correctly for its role within the system.</p>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="docs_consensus_mechanism_contract.html" class="btn btn-neutral float-left" title="ConsensusMechanism Contract Documentation" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="docs_chainlink_automation_contract.html" class="btn btn-neutral float-right" title="ChainlinkAutomation Contract Documentation" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2024, Pouya.N.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>